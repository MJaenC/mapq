//Constant Values
input.symbols :`CLF`CYH`HCN`HGY`HMMJ`MGB`PSU.U`QQC.F`SVR`VAB`VBAL`VCE`VGH`XEM`XFC`XFH`XMA`ZCS`ZDM`ZEA`ZEB`ZEM`ILV`REIT`XFI`ZFS`ZPS`BDIV`BGC`BGU`BLCK`BND`CARS`CARS.B`CBH`CBO`CDZ`CEW`CGL`CGL.C`CGR`CIF`CLG`CMR`COMM`COW`CPD`CSD`CUD`CVD`CWW`CYBR`CYBR.B`DFC`DFU`DISC`DIVS`DLR`DRFD`DXC`DXF`DXG`DXP`DXU`DXV`DXZ`EDGE`EQL`EQL.F`ETHI`ETP`FCCD`FCID`FCRH`FCRR`FCUD`FCUH`FHH`FHQ`FIE`FLDM`FLEM`FLGD`FLRM`FLUS`FOUR`FSL`FST`FST.A`FUD`HAB`HAC`HAF`HAJ`HAL`HAU`HAZ`HBAL`HBB`HBD`HBF`HBF.U`HBG`HBG.U`HBLK`HBU`HEMB`HFMU`HFMU.U`HFP`HFR`HFY`HFY.U`HGD`HGM`HGR`HGU`HHF`HHL`HHL.U`HIX`HMMJ.U`HND`HNY`HOD`HOG`HPF`HPR`HQD`HQU`HSD`HSH`HSL`HSU`HTA`HTB`HUBL`HUC`HUG`HUL.U`HUN`HUV`HUZ`HXDM`HXE`HXF`HXH`HXQ`HXS`HXS.U`HXT`HXU`HXX`HYI`HZD`HZU`IGCF`INOC`INSR`KILO.B`LIFE`LIFE.B`MCLC`MEE`MEU`MFT`MIND`MINT.B`MKB`MKC`MUB`MULC.B`MUMC.B`MUS`MWD`MXU`PBI`PBI.B`PDC`PDF`PDIV`PFH.F`PHE`PHE.B`PHR`PHW`PID`PINC`PINV`PLV`PMIF`PMM`PR`PRA`PRP`PSA`PSB`PTB`PXC`PXS`PXU.F`PYF`PYF.U`PZW`PZW.U`QAH`QCD`QCN`QDX`QEM`QIE`QMY`QUS`QUU`RBNK`RBO`RBOT`RCD`RGRE`RID`RID.U`RIDH`RIG`RLB`RLD`RLE`RPD`RPF`RUBY`RUBY.U`RUD`RUD.U`RUDH`RUSB`RXD`SBT.B`SEED`SHZ`SVR.C`SYLD`THU`TLV`TPE`TPU`TTP`TUSB`ULV.F`VA`VAH`VBG`VBU`VCN`VCNS`VDU`VDY`VE`VEE`VEF`VEH`VFV`VGG`VGRO`VI`VIDY`VIU`VLB`VLQ`VMO`VRE`VSB`VSC`VSP`VUN`VUS`VVL`VVO`VXC`XAW`XBAL`XBB`XBM`XCB`XCD`XCG`XCH`XCS`XCV`XDG`XDGH`XDIV`XDU`XDUH`XDV`XEB`XEC`XEF`XEG`XEH`XEI`XEN`XEU`XFN`XFR`XGB`XGD`XGI`XGRO`XHB`XHC`XHD`XHU`XHY`XIC`XID`XIG`XIN`XIT`XIU`XLB`XMC`XMD`XMH`XMI`XML`XMM`XMS`XMU`XMV`XMW`XMY`XPF`XQB`XQQ`XRB`XRE`XSB`XSC`XSE`XSH`XSI`XSP`XST`XSU`XTR`XUH`XUS`XUT`XUU`XWD`ZAG`ZBK`ZCH`ZCM`ZCN`ZDB`ZDH`ZDI`ZDJ`ZDV`ZDY`ZDY.U`ZEF`ZEO`ZEQ`ZEUS`ZFH`ZFM`ZFN`ZGD`ZGI`ZGQ`ZHP`ZHY`ZIC`ZID`ZIN`ZJG`ZJK`ZJN`ZJO`ZLB`ZLC`ZLD`ZLE`ZLH`ZLI`ZLU`ZLU.U`ZMI`ZMP`ZMT`ZMU`ZPH`ZPL`ZPR`ZPW`ZQQ`ZRE`ZSP`ZSP.U`ZST`ZST.L`ZSU`ZUB`ZUD`ZUE`ZUH`ZUP`ZUQ`ZUT`ZVU`ZWA`ZWB`ZWC`ZWE`ZWH`ZWH.U`ZWP`ZWS`ZWU`BKL.F`CAN`CAPS.U`CCX`CHB`CIE`CJP`CLU`CLU.C`CRQ`CWO`DLR.U`EARN`ELV`HEW`HMP`HRES`HXT.U`LDGR`LINK`MJJ`PGL`PPS`PUD`PXG`PXG.U`PZC`QCH`QEF`QIF`QTIP`RCE`RIE`RPS`RUE`RUE.U`RUEH`SCGI`SHC`USB`XFA`XFF`XFS`XSQ`ZCB`ZFL`ZTL`ZTL.U`ZTS`DWG`FBCN`GHD`GHD.F`HMJR`RCAN`RCSB`REEM`RINT`RLDR`RUSA`UHD`BPRF`DXB`DXO`FTB`HII`RQH`TDB`THE`TPRF`VGV`ZIC.U`ZRR`GOGO`HGC`RTA`VCB`RCUB`HRA`ICPB`PBD`PFL`RQL`TCSB`ZCS.L`HAD`RPSB`RBDI`RMBO`RQG`ZFS.L`ZPS.L`FIXD`FLCI`HUF.U`VSG`PMIF.U`RQI`RQJ`DCU`RPU`RQK`RQN`CAGG`CAGS`DGR`DGR.B`DGRC`DQD`EHE.B`IQD.B`JAPN`JAPN.B`ONEB`ONEQ`UMI`BANK`DCP`DFD`DRMC`DRMU`EQL.U`EUR`FDE`FHG`FLGA`HARC`HCON`HERS`HTA.U`HTH`HUBL.U`HUF`HXQ.U`MINT`MIVG`MULC`MUSC.B`PIN`QBB`QHY`QMA`QUIG`RPD.U`RPDH`RUBH`RXD.U`STPL`ULV.C`ZFC`ZMSB`ZPW.U`ZSB`ZVI`ETAC`HXDM.U`QCB`RIEH`RXE`RXE.U`SCGR`THNK`BGU.U`TUSB.U`MHYB`DRCU`DCG`DCS`FSD.A`ZGSB`CHNA.B`EHE`IQD`MWMN`BNC`CALL`DFE`EGIF`FHH.F`MCSM`MEME.B`PZW.F`QDXH`QGL`RIG.U`ZVC`HTB.U`PEU`PEU.B`PFG`PSY`PUD.B`RDE`ZTM`BHAV`IEMB`IGB`USB.U`ZTM.U`ZUP.U`SFIX`RPU.U`ZTS.U`PCF`PGB`DQI`CAPS`CAPS.B`DRFC`DRFU`KILO`MPCF`MUMC`QCE`RIE.U`SHE`UHD.U`FLSL`MUSC`RUSB.U`SINT`ZCPB`HADM`MCSB`EMV.B`EUR.A`HERS.B`SCAD`BKL.C`REM`FSL.A`SUSA`ZGB`FSD`PSY.U`BFIN`FLBA`FLUI`HID.B`HUL`WOMN`HCBB`BKL.U`HPF.U`PYF.B`RBOT.U`UHD.F`HEUR`PIB`ZZZD`ULV.U`PXS.U`DCC`HGGG`HUTL`CALL.B`HID`EQE.F`FDE.A`TIME`QSB`SBT`CMCE`CMUE`CMUE.F`ETP.A`FHQ.F`KILO.U`CAFR`CACB`HEWB`HCRE`DANC`FCQH`FCUQ`EQE`FCUL`FCLH`FCCL`FCCQ`FCIL`FCIQ`QGB`IGLB`FUD.A`SBT.U`FHG.F`RPU.B`SBEA`PMNT`VCIP`VEQT`FINT`UMI.B`NPRF`NFAM`NREA`NALT`PLDI`ZBAL`ZGRO`ZWK`ZUS.V`ZNQ`ZUS.U`ZCON`ZHU`FLAM`FLCD`FLJA`FLUR`HLPR`DRFE`DRFG`HAU.U`XESG`XSUS`XSEA`XSEM`XSAB`CARS.U`TLF`HIG`ILV.F`XSTB`XGGB`USMJ`HMUS.U`HMUS`EDGF`FSB`TXF`WXM`BXF`CIC`CSY`CXF`DXM`FAI`FBE`FBU`FDV`FGO`FHB`FHI`FIG`FLI`FPR`FQC`FXM`NXF`NXF.B`QXM`RIT`RWU.B`SID`TXF.B`UXM`UXM.B`VXM`VXM.B`XXM`XXM.B`YXM`YXM.B`ZXM`ZXM.B`CES`CES.B`RWW`RWW.B`RWC`FIG.U`RWE.B`FGO.U`FSB.U`FGB`FLB`FHI.B`FSF`FUT`RWU`RWE`RWX`RWX.B`CED`TGED`TILV`ATSX`HDGE`ALFA`HURA`TEC`PAYF`CYBR.U`HMJI`HMJU`FCSW`HWF`RCDB`BASE`HERO`BASE.B`CSAV`HQD.U`FLCP`FLSD`PFMN`PFMS`PFAE`PFIA`EARK`EAGB`EAAI`EAUT`QEBH`HFA`EAFT`HCB`CGAA`HIG.U`XEQT`XINC`XCNS`BPRF.U`BFIN.U`CGXF`TLF.U`AUGB.F`XVLU`XQLT`XSMC`XSMH`HGRO`XMTM`CESG.B`FCCB`FCGB`FCSB`FCHH`FCHY`PREF`CESG`QBTL`QUDV`XUS.U`XEF.U`XDG.U`QEBL`IGAF`XUU.U`IFRF`XDU.U`XMU.U`XAW.U`ISIF`XEC.U`NUBF`HISA`TGRE`TGFI`TQCD`TQGD`TUHY`TCLB`TPAY`HNU`HED`HEU`HFD`HFU`HOU`HXD`TULB`HIU`TQSM`TQGM`CALL.U`XMC.U`LIFE.U`HUIB`XFS.U`ESGA`ESGE`ESGF`ESGG`ESGY`ZPAY`ZPAY.F`ZWG`ZPAY.U`ZESG`FCGI`FCMI`ESGB`RIIN`RIRA`VGAB`CMAG`CMAR`CRED`CRED.U`CFLX`CMAR.U`HULC`HULC.U`HXCN`NOVB.F`HSAV`ZTL.F`ZQB`ZMID`ZMID.F`ZMBS`ZBBB`PCOR`ZSML`PCON`DXN`DXW`ZSML.F`FEBB.F`HBGD`HBGD.U`RIFI`NGPE`NSCE`ESG`ESG.F`NSGE`NHYB`HTA.B`UDA`HHL.B`HBF.B`ARB`NSCB`ZMID.U`XCSR`XUSR`ZSML.U`XDSR`DRMD`BLOV`BREA`CCOR`CCOR.U`CDLB.B`CINC`CCOR.B`CDLB`CINC.B`RIGU`CDLB.U`CMEY`CMEY.U`MAYB.F`CGRE`CINF`CGRA`HFT`TCLV`TGGR`TINF`TUED`EAUT.U`TULV`CINC.U`FCCV`FCIG`FCIV`FCMH`FCMO`FCUV`FCVH`FCIM`FCCM`LONG`WSRD`WSRI`HCA`HFG`HUM`HUM.U`HBA`HSUV.U`EAAI.U`EARK.U`EAFT.U`PFLS`ZUQ.F`ZUQ.U`CINT`CGLO`HRAA`HXEM`GIGR`GIGR.B`GIQU`GIQU.B`GDEP`GDEP.B`GDPY`GDPY.B`GIQG`GIQG.B`TOCA`TOCM`TOCC`EAGB.U`GGRO`NCG`GBAL`GEQT`GCNS`LEAD`LEAD.U`LEAD.B`VRIF`QDXB`QUB`MBAL`MCON`MGAB`MGRW`GLC`QRET`QUU.U`RQP`RQO`MDVD.U`AGSG`FGGE`QINF`ESGC`HCAL`MDVD`AGLB`CCRE`CPLS`CCNS`SITI`MOM`BESG`SITC`MOM.F`SITB`MOM.U`SITU`GLDE`SLVE`NSAV`NBND`CDIV`TERM`UDIV`UDIV.B`CBND`BSKT`SLVE.U`TMEC`TMEI`TMEU`HARB`HARB.J`DATA`DATA.B`CMGG`VALT`VALT.U`EDGE.U`HCLN`TRVL`TRVL.U`CMAG.U`CMGG.U`ZAUT`ZCLN`ZFIN`ZGEN`ZINN`ZINT`ZTIP`ZTIP.F`ZWT`FBAL`FGRO`ZTIP.U`ESGY.F`ONEC`BITC.U`PSYK`FINO`SBCM`SBCV`SBQM`SBQV`NDIV`NINT`NSCC`NUSA`CIBR`FBT`FDN`FDN.F`NXTG`QCLN`SKYY`BTCC.B`BTCC.U`ESGH.F`FDL`EBIT`EBIT.U`ESGH`ZNQ.U`BTCC`BTCX.B`BTCX.U`ZJK.U`HYBR`XCLR`DRME`XULR`GGAC`GGEM`FJFG`FJFB`XDLR`BDOP`BDEQ`VALT.B`EAXP`EAXP.U`CUEI`DXIF`DXR`GCSC`GCBD`CCEI`CIEI`CCBI`ORBT`ORBT.U`BBIG`BBIG.U`TDOC`BITI`BITI.U`HBIT`BTCQ`BTCQ.U`ETHH`ETHH.B`ETHH.U`ETHR`ETHR.U`ETHX.B`ETHX.U`HARB.U`ETHQ`ETHQ.U`CLMT`TECH`TECH.B`TECH.U`BITC`FIVE`SIXT`FIVE.B`FIVE.U`WSHR`NNRG`NACO`NAHF`QQC`QQEQ`QQEQ.F`QQJR`QQJR.F`HGGB`ZACE`DXEM`DXET`CHPS`HLIT`HYDR`CHPS.U`RATE`FBGO`FCII`FCSI`XSTP`XIGS`CLML`CLML.U`CNAO`CNAO.U`XCBU`XCBU.U`XSTP.U`XSTH`XSHU`PFSS`CSCE`CSGE`HDIV`CSBG`FSEM`FGSG`XSHU.U`CSCB`CSBA`XSHG`XAGG`CINV`CINV.U`CMDO`CUSM.B`XAGG.U`XAGH`CHCL.B`CUSA.B`XCBG`CCDN`CMDO.U`ILGB`ABTC`ABTC.U`CIEM`CIEM.U`HRED`HREU`CTIP`CSCP`CEMI`CGBI`HAEB`MGSB`CROP`ETC`ETC.U`HEMC`HVAX`BLDR`CASH`HSPN`HSPN.U`BTCC.J`ETHH.J`CDEF`UDEF`UDEF.B`QQCE`QQJE`QQCE.F`CCLN`CQLU`CQLC`CQLI`QQJE.F`BEPR`MESH`MTAV`BTCY.B`ETHY.B`TECI`CRYP`CRYP.B`CRYP.U`TMCC`TMUC`FCIG.U`FCMO.U`FCUD.U`ZMMK`BTCY`ETHY`FBTC`HBUG`FBTC.U`HDOC`BTCY.U`FCIQ.U`ETHY.U`FCGB.U`FCRR.U`FCUQ.U`FCUV.U`FLX.U`FLX`FLX.B`EBNK.B`EBNK.U`EBNK`SRIC`SRII`SRIU`SRIB`HEAL`WSGB`IICE`ISTE`IWBE`IXTE`FEQT`FCNS`HFIN`ZBAL.T`ZEQT`ZGRN`ZJPN`ZSDB`ZWB.U`DSAE`ZCDB`ZPR.U`CMCX.B`CMCX.U`IUTE`ZMI.U`FWCP`IITE`IUCE`HYLD`HYLD.U`BEPR.U`QEE`CARB`IUTE.F`ZBI`ZJPN.F`NSSB`ISTE.F`IITE.F`HDIF`CBON`IICE.F`CBON.U`IUCE.F`ERCV`ERDO`ERDV`EREO`EREV`ERFO`ERFV`ERGO`NNRG.U`CBNK`CBUG`CDNA`TECE`TECE.B`TECE.U`GRNI`TOWR`NRGI`CGXF.U`TXF.U`FHI.U`NXF.U`MHCD`MINF`MINN`MREL`MUSA`MDIV`TUED.U`TGED.U`TPU.U`TEC.U`TDOC.U`CGHY`CGHY.U`CFRT`XDNA`XEXP`XHAK`CBCX`CMVX`XCLN`PFAA`COPP`FMTV`FCUL.U`HLIF`ENCC`GLCC`USCC`QQCC`CNCC`BKCC`TIF`USCC.U`BDIC`UTIL`TCBN`HISU.U`LYCT`LYFR`HUTS`EPCA.U`EPZA.U`EPGC.U`FHIS`EPGC`EPWR`HBKD`HBKU`EPCA`MNY`DXQ`GPMD`BILT`HESG`CGRN`CCOM`CGRB`FETH`CROP.U`FETH.U`DAMG`DANC.U`DAMG.U`BMAX`RQQ`EPCH`HLFE`HBFE`HHLE`HTAE`HUTE`CGRN.U`MPY`CGIN`CGIN.U`DXDB`IDIV.B`IDEF.B`PFCB`UDIV.U`RQR`ARKG`ARKK`ARKW`EPZA`SITE`ACAA`APLY`BRKY`YAMZ`YGOG`YTSL`ESPX`ESPX.B`ETSX`RCDC`RUDC`CUEH`HMAX`CSBI`CGDV`CGDV.B`ZEAT`ZGRO.T`ZUAG`ZUAG.F`ZWEN`ZWHC`TIPS`CGRB.U`XLVE`ZUAG.U`TIPS.F`TIPS.U`XTLT`XDRV`XEMC`XTLT.U`XTLH`XFLB`CUDV`EPCH.U`ICAE`IUAE`IUAE.F`IIAE`CUTL`RCEI`RENG`RNAV`RTEC`RNAG`CUDV.B`RGPM`REMD`CIEH`HEB`CUTL.B`HRIF`TRVI`CBIL`UBIL.U`MCKG`TBNK`TECX`TUEX`MNU.U`UDEF.U`RGQQ`RGQR`GDIV`GBND`CBAL`CBGR`RUDB`CGRO`RUDB.U`BUFR`FCGC`FCGS`FCGS.U`FCLC`FINN`FINN.U`BGIF`BKCL`BNKL`CANL`CNCL`ESPX.U`FEME`FINC`GCTB`HBNK`HEQT`IGET`IIAE.F`IIMF`IUMF`MCAD`QQQT`RGQL`RGQN`RGQO`RGQP`SPLT`TKN`TKN.U`UMAX`UMNY.U`USCL`ZUGE`ZWQT`BGHC`BGIN`FINE`RDBH`TBAL`TCON`TGRO`AENU`BGEQ`CMNY`FGRW`ZUVE`BGRT`CCNV`ICTE`QQQT.B`RUDC.U`GUTB.U`IUMF.F`MUSD.U`IGET.F`XETM`XQQU`XAD`XCHP`XQQU.U`XUSF`CBIN`HBND`QQQT.U`CEQT`IIMF.F`HPYT`ZEBA`ZIU`ZLSC`ZLSU`ZOCT`ZUCM`ZUEA`BGDV`ZUCM.U`BOND`QQQY`LPAY`MPAY`SPAY`ENCL`EQCL`GRCC`HEQL`HGRW`QQCL`RTT`DXGE`DXUS`PAGF`AEMX`PABF`PACF`DXBU`QMAX`SMAX`IGEO`DXBC`IWEB`GCFE`MEQT`QASH`QLB`QTLT`GIES;
input.startTimeT : 09:30:00.000;
input.startTimeQ : 09:25:00.000;
input.endTime :  16:00:00.000;
input.columnsT : `sym`listing_mkt`time`volume`mkt /`volume`price`total_value`listing_mkt`event`b_type`s_type`b_market_maker`s_market_maker`b_active_passive`s_active_passive `trade_stat`trade_correction`s_dark`b_dark`s_internal_cross`mkt`s_short`s_short_marking_exempt`b_short_marking_exempt`s_user_name`b_user_name`s_program_trade;
input.columnsQ : `sym`listing_mkt`mkt`time`nat_best_bid`nat_best_offer`nat_best_bid_size`nat_best_offer_size`ask_price`bid_price`ask_size`bid_size;
input.tableQ : `quote;
input.tableT : `trade;
input.applyFilterT : ((=;`event;enlist`Trade);(<>;`trade_stat;enlist`C);(=;`trade_correction;"N");(>;`volume;0);(in;`listing_mkt;enlist`TSE`AQL)); 
input.applyFilterQ : ((>;`ask_price;`bid_price);(<;`ask_price;0W);(>;`bid_price;0);(>;`nat_best_offer;`nat_best_bid);(within;`nat_best_offer;(enlist;(%;`nat_best_bid;3);(*;3;`nat_best_bid))));
               

//Create empty table to store results
output.cols: `date`mkt`sym`listing_mkt`maxbid`min_ask`last_bid`last_ask`last_mid_price`total_volume`total_value`vwap`adv`range`maxprice`minprice`last_price`num_of_trades`num_of_block_trades`block_volume`block_value`dark_volume`dark_value`num_of_dark_trades`short_volume`total_short_value`num_of_short_trades`dqs`pqs`num_quotes`des_k`pes_k`wmid`volumebuy`volumesell`orderbookimbalance`realized_vol`drs_k_1m`prs_k_1m`drs_k_5m`prs_k_5m`dpi_k_1m`ppi_k_1m`dpi_k_5m`ppi_k_5m;
dailyliqmet: flip (output.cols)!(`date$();`symbol$();`symbol$();`symbol$();`float$();`float$();`float$();`float$();`float$();`long$();`float$();`float$();`float$();`float$();`float$();`float$();`float$();`long$();`long$();`long$();`float$();`long$();`float$();`long$();`long$();`float$();`long$();`float$();`float$();`long$();`float$();`float$();`float$();`long$();`long$();`float$();`float$();`float$();`float$();`float$();`float$();`float$();`float$();`float$();`float$());

    
hhi: flip `sym`listing_mkt`date`hhi_volume!(`symbol$();`symbol$();`symbol$();`float$())
//Inititate while loop
i:0;
while[i<count[calendar];
    //Get Pairs in right order for Kalman Filter
    input.startDate:  last calendar[i];
    input.endDate: first calendar[i];
    
    //Get Trade Data
    getData.edwT: `..getTicks[`assetClass`dataType`symList`startDate`endDate`startTime`endTime`columns`applyFilter!(`equity;
        input.tableT;
        input.symbols;
        input.startDate;input.endDate;
        input.startTimeT;input.endTime;
        input.columnsT;
        input.applyFilterT)]; 
    
     hhi,: 0! select hhi_volume: sum mkt_share by sym, listing_mkt, date: `$ssr[;".";"-"] each string date from update mkt_share: (volume%daily_volume) xexp 2 from (`sym`listing_mkt xasc 0! select daily_volume: sum volume by sym, listing_mkt, date: `date$time from getData.edwT) lj `sym`listing_mkt`date xkey select sym, listing_mkt, date: `date$time, mkt, volume from getData.edwT;
     hhi: distinct hhi;
    {[t] ![t;enlist(>;`i;-1);0b;`$()]} each `getData.edwT;
    
    //Iterate again
    i+: 1;
    ];
